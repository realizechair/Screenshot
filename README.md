# 📸 スクリーンショット注釈ツール

業務で使うスクリーンショットに、**最短動線で枠線とテキスト注釈を入れる**Webアプリです。

## 🎯 特徴

- **即座に注釈開始**: クリップボードから貼り付け（Ctrl/⌘+V）で即編集
- **豊富な機能**: 枠線・矢印・テキスト・番号スタンプ
- **自由な色設定**: カラーピッカーと線の太さ調整
- **軽量・高速**: Vanilla JS + Canvas、依存なしで動作
- **ローカル完結**: サーバー不要、ブラウザだけで完結
- **業務向け**: 視認性の高いデザイン、ショートカット完備

## 🚀 デモ

**公開URL**: [https://3000-iqc2ht4q1h6zi61gohpno-2e1b9533.sandbox.novita.ai](https://3000-iqc2ht4q1h6zi61gohpno-2e1b9533.sandbox.novita.ai)

## 📦 ローカル起動手順

### 必要環境
- Python 3（HTTPサーバー用）
- または任意のHTTPサーバー

### 起動方法

```bash
# リポジトリをクローン
git clone <repository-url>
cd webapp

# HTTPサーバー起動（Python版）
python3 -m http.server 3000

# または npm scriptsを使用
npm start
```

ブラウザで `http://localhost:3000` を開く

## 🖼️ 使い方

### 1. 画像を読み込む（3つの方法）

#### 方法A: クリップボードから貼り付け（推奨）
1. スクリーンショットを撮る（Windows: `Win+Shift+S`, Mac: `Cmd+Shift+4`）
2. アプリを開いて **`Ctrl/⌘+V`** で貼り付け
3. 即座に編集開始！

#### 方法B: ドラッグ&ドロップ
- 画像ファイルをブラウザにドラッグ

#### 方法C: ファイル選択
- 「📁 画像読み込み」ボタンをクリック

### 2. 注釈を追加

#### 枠線(ハイライト)
1. 「🔲 枠線」ボタンをクリック（または `R` キー）
2. マウスでドラッグして矩形を描画
3. 複数作成可能

#### 矢印(NEW!)
1. 「➡️ 矢印」ボタンをクリック（または `A` キー）
2. マウスでドラッグして矢印を描画
3. 複数作成可能

#### テキストコメント
1. 「📝 テキスト」ボタンをクリック（または `T` キー）
2. 配置したい場所をクリック
3. テキストを入力して Enter

#### 番号スタンプ(NEW!)
1. 「🔢 番号」ボタンをクリック（または `N` キー）
2. 配置したい場所をクリック
3. 自動で番号が増える(1, 2, 3...)

#### 色と線の太さ変更(NEW!)
- 🎨 アイコンをクリックして色を選択
- スライダーで線の太さを調整(1-10px)

### 3. 編集

#### 選択・移動
1. 「↖️ 選択」ボタンをクリック（または `V` キー）
2. オブジェクトをクリックして選択
3. ドラッグで移動

#### リサイズ
- 選択したオブジェクトの四隅をドラッグ

#### 削除
- オブジェクトを選択して `Delete` キーまたは「🗑️ 削除」ボタン

#### Undo/Redo
- `Ctrl/⌘+Z`: 元に戻す
- `Ctrl/⌘+Shift+Z`: やり直し
- ツールバーのボタンでも操作可能

### 4. 出力

「💾 PNG出力」ボタンをクリックして、注釈入り画像をダウンロード

ファイル名: `annotated_YYYYMMDD_HHMMSS.png`

## ⌨️ ショートカットキー

| キー | 機能 |
|------|------|
| `Ctrl/⌘+V` | クリップボードから画像貼り付け |
| `V` | 選択/移動ツール |
| `R` | 枠線ツール |
| `A` | 矢印ツール |
| `T` | テキストツール |
| `N` | 番号スタンプ |
| `Delete` / `Backspace` | 選択オブジェクト削除 |
| `Ctrl/⌘+Z` | Undo（元に戻す） |
| `Ctrl/⌘+Shift+Z` | Redo（やり直し） |
| `Ctrl/⌘+Y` | Redo（やり直し） |
| `Enter` | テキスト編集確定 |
| `Escape` | テキスト編集キャンセル |

## 📁 ファイル構成

```
webapp/
├── index.html          # メインHTML
├── style.css           # スタイルシート
├── app.js              # アプリケーションロジック
├── package.json        # npm設定
├── ecosystem.config.cjs # PM2設定（オプション）
├── .gitignore          # Git除外設定
└── README.md           # このファイル
```

## 🏗️ 技術仕様

### データ構造

#### オブジェクトモデル
```javascript
// 矩形（枠線）
{
  id: number,
  type: 'rect',
  x: number,
  y: number,
  width: number,
  height: number,
  strokeStyle: string,  // '#ff3b30'
  lineWidth: number     // 3
}

// テキスト
{
  id: number,
  type: 'text',
  x: number,
  y: number,
  width: number,
  height: number,
  text: string,
  fontSize: number,     // 18
  fontFamily: string,   // 'Noto Sans JP, sans-serif'
  fillStyle: string,    // '#000'
  backgroundColor: string, // 'rgba(255, 255, 255, 0.9)'
  padding: number       // 8
}
```

#### 履歴管理
- オブジェクト配列をJSON文字列化して保存
- 最大50段階の履歴
- 新規操作時に分岐履歴を削除

### 描画フロー
1. Canvas全体をクリア
2. 画像を描画（背景）
3. 全オブジェクトを描画（レイヤー順）
4. 選択オブジェクトのハンドルを描画

### 座標管理
- Canvas座標系を直接使用
- DPIスケーリングは未実装（通常のディスプレイでは問題なし）
- リサイズ時は画像アスペクト比を維持

## ⚠️ 既知の制約と対策

### 1. 大きい画像のパフォーマンス
- **現状**: コンテナサイズに収まるように自動リサイズ
- **対策**: 再描画を最小化（ドラッグ中は毎フレーム描画）

### 2. テキストの改行
- **現状**: 単一行のみ対応
- **将来対応**: Shift+Enterで改行、自動折り返し

### 3. DPI/Retina対応
- **現状**: 未実装（通常ディスプレイでは問題なし）
- **対策案**: `window.devicePixelRatio` を使用したスケーリング

### 4. モバイル対応
- **現状**: PC Chrome推奨
- **制約**: タッチイベント未実装

### 5. 日本語入力（IME）
- **現状**: 別要素（input）で入力することで安定動作
- **対策済み**: Canvas直接入力ではなくHTML input要素を使用

## 🔧 改善案（今後の拡張）

### 優先度: 高
- [ ] テキストの複数行対応（改行・折り返し）
- [ ] 枠線の色・太さ変更
- [ ] オブジェクトの重ね順変更（前面/背面）
- [ ] Retina対応（高DPI）

### 優先度: 中
- [ ] 矢印ツール追加
- [ ] ぼかし（モザイク）ツール
- [ ] テキストのフォントサイズ変更
- [ ] カラーピッカー

### 優先度: 低
- [ ] 画像のズーム・パン
- [ ] グリッド表示
- [ ] 画像の回転
- [ ] JPEGでの出力オプション

### 実装しない機能（スコープ外）
- ❌ 手書きペンツール（業務では不要）
- ❌ スタンプ・絵文字
- ❌ フィルター・エフェクト
- ❌ レイヤー管理（複雑すぎる）

## 🐛 トラブルシューティング

### 画像が読み込めない
- ファイル形式を確認（PNG, JPEG, GIF対応）
- ブラウザのコンソールでエラー確認

### テキストが入力できない
- 日本語入力の場合、input要素にフォーカスがあるか確認
- Enterで確定、Escapeでキャンセル

### Undo/Redoが効かない
- 履歴は操作完了時（マウスアップ時）に保存されます
- ドラッグ中は履歴に追加されません

### 出力画像が期待と異なる
- 選択ハンドルは出力に含まれません
- Canvas表示そのままが出力されます

## 📄 ライセンス

MIT License

## 👨‍💻 開発情報

- **技術スタック**: Vanilla JavaScript, HTML5 Canvas, CSS3
- **依存関係**: なし（ブラウザAPIのみ）
- **対応ブラウザ**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **開発環境**: Python 3 HTTPサーバー / PM2

## 🤝 コントリビューション

バグ報告や機能要望は Issues へ。

Pull Request も歓迎します！

---

**🚀 今すぐ試す**: [https://3000-iqc2ht4q1h6zi61gohpno-2e1b9533.sandbox.novita.ai](https://3000-iqc2ht4q1h6zi61gohpno-2e1b9533.sandbox.novita.ai)
